osmdata_sf()
q2 = q[6][[1]]
names(q2)
plot(q2$geometry)
q3 = bbox %>%
opq() %>%
add_osm_feature("water") %>%
osmdata_sf()
q4 = q3[8][[1]]
names(q4)
plot(q4$geometry, add = TRUE)
q5 = st_union(q2, q4, by_feature = TRUE)
plot(q5$geometry)
g = st_union(q5)
plot(g)
g2 = st_sf(st_cast(g, "POLYGON"))
g2$line_id = 1:nrow(g2)
plot(st_geometry(g2), col = g2$line_id)
g2$area = st_area(g2)
g2 = g2 %>% filter(area>set_units(200000,"m2"))
plot(g2$geom, col = g2$line_id)
bbox_poly = st_as_sfc(bbox)
bbox_poly
bbox_line = st_cast(bbox_poly, "LINESTRING")
plot(bbox_poly, add = TRUE)
gg = st_intersection(g2, bbox_poly)
plot(gg$geom)
m = midlines_draw(gg)
plot(m$geom, col = m$line_id, add = TRUE)
m2 = midlines_clean(m, n_removed = 40, border_line = bbox_line)
plot(gg$geom)
plot(m2$geometry[m2$removed_flag==0])
table(m2$removed_flag)
plot(m2$geometry)
m2 = filter(m2, m2$removed_flag==0)
m3 = midlines_clean(m2, n_removed = 3, border_line = bbox_line)
#plot(gg$geom)
plot(m3$geometry[m3$removed_flag==0])
table(m3$removed_flag)
plot(m3$geometry)
plot(m3$geometry[m3$removed_flag==0], col = m3$line_id)
m3 = filter(m3, m3$removed_flag==0)
m4 = midlines_clean(m3, n_removed = 10, border_line = bbox_line)
plot(m4$geometry[m4$removed_flag==0], col = "red")
####
#investigate
m2 = filter(m2, m2$removed_flag==0)
m2 = midlines_group(m2)
m2 = st_cast(m2, "LINESTRING")
m2$lines_id = 1:nrow(m2)
plot(m2$geometry, col = m2$lines_id)
View(m2)
m2$length = st_length(m2)
View(m2)
plot(m2$geometry[3])
plot(m2$geometry[2])
plot(m3$geometry, col = m3$line_id)
plot(m2$geometry[2])
plot(m3$geometry, col = m3$line_id, add = TRUE)
plot(m$geometry, col = m3$line_id, add = TRUE)
st_line_sample(g)
q = bbox %>%
opq() %>%
add_osm_feature("water") %>%
osmdata_sf()
q2 = q[6][[1]]
names(q2)
plot(q2$geometry)
q3 = bbox %>%
opq() %>%
add_osm_feature("water") %>%
osmdata_sf()
q4 = q3[8][[1]]
names(q4)
plot(q4$geometry, add = TRUE)
q5 = st_union(q2, q4, by_feature = TRUE)
plot(q5$geometry)
g = st_union(q5)
plot(g)
g
la_nantes = st_read("C:/Users/richa/OneDrive - University of Cambridge/fr_cyclables/data/clean/la_nantes.gpkg")
st_crs(g) = 1936
st_crs(la_nantes)
st_crs(g) = 27700
g
st_line_sample(g, set_units(10, "m"))
plot(g)
g
st_cast(g, "Linestring")
st_cast(g, "LINESTRING")
g2 = st_sf(st_cast(g, "POLYGON"))
st_cast(g, "POLYGON")
st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = st_sf(st_cast(st_cast(g, "POLYGON"), "LINESTRING"))
st_line_sample(g2)
st_line_sample(g2, density = set_units(10, "m"))
g2 = st_line_sample(g2, density = set_units(10, "m"))
View(g2)
g2 = st_sf(st_cast(st_cast(g, "POLYGON"), "LINESTRING"))
View(g2)
lengths(g2)
lengths(g2$st_cast.st_cast.g...POLYGON.....LINESTRING..)
g2 = st_line_sample(g2, density = set_units(10, "m"))
View(g2)
g2 = st_sf(st_cast(st_cast(g, "POLYGON"), "LINESTRING"))
g2
lapply(1:nrow(g2), function(x) {st_line_sample(g2[x], density = set_units(10, "m"))} )
gh = function(x) {st_line_sample(g2[x], density = set_units(10, "m"))}
lapply(1:nrow(g2), gh)
gh = function(x) {st_line_sample(g2$st_cast.st_cast.g...POLYGON.....LINESTRING..[x], density = set_units(10, "m"))}
lapply(1:nrow(g2), gh)
View(g2)
st_length(g2)
g
g
library(osmdata)
#library(ggmap)
library(dplyr)
library(sf)
library(units)
library(devtools)
load_all()
g = st_read("working/thames.gpkg")
plot(g$geom)
bbox = st_bbox(c(xmin = -0.0585, xmax = 0.0655, ymin = 51.4753, ymax = 51.5162), crs = 4326)
bbox_poly = st_as_sfc(bbox)
plot(bbox_poly, add = TRUE)
st_ftransform(g, 27700)
st_transform(g, 27700)
st_transform(bbox, 27700)
st_transform(bbox_poly, 27700)
bbox_poly = st_transform(bbox_poly, 27700)
bbox = st_bbox(bbox_poly, crs = 27700)
g2 = st_sf(st_cast(g, "POLYGON"))
st_line_sample(g2, density = set_units(10, "m"))
g2
g
g = st_transform(g, 27700)
g#
bbox_poly = st_transform(bbox_poly, 27700)
bbox = st_bbox(bbox_poly, crs = 27700)
st_line_sample(g2, density = set_units(10, "m"))
g
st_cast(g, "POLYGON")
st_sf(st_cast(g, "POLYGON"))
g2 = st_sf(st_cast(g, "POLYGON"))
g2
st_line_sample(g2, density = set_units(10, "m"))
g2 = st_sf(st_cast(st_cast(g, "POLYGON")), "LINESTRING")
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
View(g2)
g2
View(g2)
st_line_sample(g2, set_units(10,"m"))
g2 = st_line_sample(g2, set_units(10,"m"))
st_cast(g2, "POLYGON")
g2 = st_cast(g2, "POLYGON")
plot(g2, col = "red")
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
View(g2)
st_length(g2)
g2 = g2[1]
g2 = g2[[1]]
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[1]
View(g2)
g2 = g2[1,]
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[1,]
g2 = st_line_sample(g2, set_units(10,"m"))
g2 = st_cast(g2, "POLYGON")
plot(g2, col = "red")
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
g2 = st_line_sample(g2, set_units(10,"m"))
g2 = st_cast(g2, "POLYGON")
plot(g2, col = "red")
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
st_length(g2)
g2 = st_line_sample(g2, set_units(10,"m"))
st_length(g2)
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
g2 = st_line_sample(g2, set_units(10,"m"))
View(g2)
g2 = st_line_sample(g2, set_units(10,"m"))
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
g2 = st_line_sample(g2, set_units(10,"m"))
lengths(g2)
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
g2 = st_line_sample(g2, set_units(10,1/m))
lengths(g2)
g2 = st_cast(g2, "POLYGON")
plot(g2, col = "red")
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
g2 = st_cast(g2, "POLYGON")
plot(g2, col = "red")
g2 = st_cast(g2, "POLYGON")
plot(g2, col = "red")
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
g2 = st_line_sample(g2, set_units(10,1/m))
View(g2)
unlist(g2)
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
unlist(g2)
g2
g2 = st_line_sample(g2, n = 1000)
lengths(g2)
g2 = st_cast(g2, "POLYGON")
plot(g2, col = "red")
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
lengths(g2)
View(g)
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
lengths(g2)
View(g2)
length(g2[[1]])
View(g2)
View(g2)
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
length(g2$geom)
lengths(g2$geom)
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
lengths(g2$geom)
g2 = st_line_sample(g2, n = 500)
lengths(g2$geom)
lengths(g2)
g2 = st_cast(g2, "POLYGON")
plot(g2, col = "red")
g2$line_id = 1:nrow(g2)
g2 = st_sf(st_cast(g2, "POLYGON"))
plot(g2, col = "red")
g2$line_id = 1:nrow(g2)
plot(st_geometry(g2), col = g2$line_id)
g
plot(g2, col = "red")
bbox_poly = st_as_sfc(bbox)
bbox_poly
bbox_line = st_cast(bbox_poly, "LINESTRING")
plot(bbox_poly, add = TRUE)
plot(bbox, add = TRUE)
plot(g2, col = "red")
plot(bbox_poly, add = TRUE)
plot(bbox_line, add = TRUE)
g = st_read("working/thames.gpkg")
g = st_transform(g, 27700)
library(osmdata)
#library(ggmap)
library(dplyr)
library(sf)
library(units)
library(devtools)
load_all()
bbox = st_bbox(c(xmin = -0.0585, xmax = 0.0655, ymin = 51.4753, ymax = 51.5162), crs = 4326)
g = st_read("working/thames.gpkg")
g = st_transform(g, 27700)
bbox_poly = st_transform(bbox_poly, 27700)
bbox_poly = st_as_sfc(bbox)
bbox_poly
g = st_read("working/thames.gpkg")
g = st_transform(g, 27700)
bbox_poly = st_as_sfc(bbox)
bbox_poly = st_transform(bbox_poly, 27700)
bbox_line = st_cast(bbox_poly, "LINESTRING")
bbox = st_bbox(bbox_poly, crs = 27700)
plot(g$geom)
plot(bbox_poly, add = TRUE)
plot(bbox_line, add = TRUE, col = "red")
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
lengths(g2$geom)
g2 = st_line_sample(g2, n = 500)
lengths(g2)
g2 = st_sf(st_cast(g2, "POLYGON"))
plot(g2, col = "red")
plot(bbox_poly, add = TRUE)
gg = st_intersection(g2, bbox_poly)
plot(gg$geom)
View(gg)
View(g2)
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2
g2 = g2[28,]
g2
lengths(g2$geom)
g2 = st_line_sample(g2, n = 500)
g2
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
lengths(g2$geom)
g2 = st_line_sample(g2, n = 500)
st_sf(g2)
g2 = st_sf(st_cast(g2, "POLYGON"))
g2
g2 = st_sf(st_line_sample(g2, n = 500))
g2 = st_line_sample(g2, n = 500)
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
lengths(g2$geom)
g2 = st_line_sample(g2, n = 500)
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
lengths(g2$geom)
g2 = st_line_sample(g2, n = 500)
g2 = st_sf(st_line_sample(g2, n = 500))
View(g2)
st_sf(g2)
g2 = st_sf(st_line_sample(g2, n = 500))
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
lengths(g2$geom)
g2 = st_line_sample(g2, n = 500)
st_sf(g2)
st_cast(g2, "POLYGON")
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
lengths(g2$geom)
g2 = st_line_sample(g2, n = 500)
g2 = st_sf(g2)
lengths(g2)
lengths(g2$g2)
g2 = st_sf(st_cast(g2, "POLYGON"))
plot(g2, col = "red")
plot(bbox_poly, add = TRUE)
gg = st_intersection(g2, bbox_poly)
plot(gg$geom)
plot(gg$g2)
m = midlines_draw(gg)
plot(m$geom, col = m$line_id, add = TRUE)
plot(gg$g2)
plot(m2$geometry[m2$removed_flag==0])
m2 = midlines_clean(m, n_removed = 40, border_line = bbox_line)
plot(gg$g2)
plot(m2$geometry[m2$removed_flag==0])
table(m2$removed_flag)
plot(gg$g2)
plot(m2$geometry, col = m2$removed_flag, add = TRUE)
m2 = midlines_clean(m, n_removed = 10, border_line = bbox_line)
plot(gg$g2)
plot(m2$geometry, col = m2$removed_flag, add = TRUE)
document()
?midlines_clean
plot(m2$geometry)
m2 = filter(m2, m2$removed_flag==0)
m3 = midlines_clean(m2, n_removed = 10, border_line = bbox_line)
#plot(gg$geom)
plot(m3$geometry[m3$removed_flag==0])
table(m3$removed_flag)
m = midlines_draw(gg)
plot(m$geom, col = m$line_id, add = TRUE)
m2 = midlines_clean(m, n_removed = 10, border_line = bbox_line)
plot(gg$g2)
plot(m2$geometry, col = m2$removed_flag, add = TRUE)
table(m2$removed_flag)
m3 = midlines_check(m2, n_removed = 10, border_line = bbox_line)
plot(m3$geometry, col = m3$removed_flag2, add = TRUE)
g = st_read("working/thames.gpkg")
g = st_transform(g, 27700)
bbox_poly = st_as_sfc(bbox)
bbox_poly = st_transform(bbox_poly, 27700)
bbox_line = st_cast(bbox_poly, "LINESTRING")
bbox = st_bbox(bbox_poly, crs = 27700)
library(osmdata)
#library(ggmap)
library(dplyr)
library(sf)
library(units)
library(devtools)
load_all()
bbox = st_bbox(c(xmin = -0.0585, xmax = 0.0655, ymin = 51.4753, ymax = 51.5162), crs = 4326)
g = st_read("working/thames.gpkg")
g = st_transform(g, 27700)
bbox_poly = st_as_sfc(bbox)
bbox_poly = st_transform(bbox_poly, 27700)
bbox_line = st_cast(bbox_poly, "LINESTRING")
bbox = st_bbox(bbox_poly, crs = 27700)
g2 = st_cast(st_cast(g, "POLYGON"), "LINESTRING")
g2 = g2[28,]
lengths(g2$geom)
g2 = st_line_sample(g2, n = 500)
g2 = st_sf(g2)
lengths(g2$g2)
g2 = st_sf(st_cast(g2, "POLYGON"))
plot(g2, col = "red")
plot(bbox_poly, add = TRUE)
gg = st_intersection(g2, bbox_poly)
plot(gg$g2)
plot(bbox_line, add = TRUE)
m = midlines_draw(gg, border_line = bbox_line)
plot(m$geom, col = m$line_id, add = TRUE)
st_intersects(m, bbox_line)
st_intersects(m, bbox_line, sparse = TRUE)
i = st_intersects(m, bbox_line, sparse = TRUE)
i = st_intersects(m, bbox_line)
i = vector(st_intersects(m, bbox_line))
m$i = st_intersects(m, bbox_line)
table(m$i)
View(m)
m$i = st_intersects(m, bbox_line, sparse = FALSE)
View(m)
st_intersects(bbox_line, m)
st_intersects(m$geometry, bbox_line)
st_touchs(m$geometry, bbox_line)
st_touch(m$geometry, bbox_line)
st_touches(m$geometry, bbox_line)
unlist(st_touches(m$geometry, bbox_line))
st_touches(m$geometry, bbox_line)
st_touches(m$geometry, bbox_line, sparse = FALSE)
st_intersects(m$geometry, bbox_line, sparse = FALSE)
m = midlines_draw(gg)
st_intersects(m$geometry, bbox_line, sparse = FALSE)
plot(g2, col = "red")
plot(gg$g2)
plot(bbox_line, add = TRUE)
plot(m$geom, col = m$line_id, add = TRUE)
View(i)
View(m)
st_intersects(m$geometry, bbox_line, sparse = FALSE)
plot(gg$g2)
bbox
c(bbox[[1]]-10, bbox[[2]]-10, bbox[[3]]+10, bbox[[4]])
st_bbox(c(bbox[[1]]-10, bbox[[2]]-10, bbox[[3]]+10, bbox[[4]]=10))
st_bbox(c(bbox[[1]]-10, bbox[[2]]-10, bbox[[3]]+10, bbox[[4]+10))
st_bbox(c(xmin = bbox[[1]]-10, ymin = bbox[[2]]-10, xmax = bbox[[3]]+10, ymax = bbox[[4]+10))
st_bbox(c(xmin = bbox[[1]]-10, ymin = bbox[[2]]-10, xmax = bbox[[3]]+10, ymax = bbox[[4]]+10))
box_p10 = st_bbox(c(xmin = bbox[[1]]-10, ymin = bbox[[2]]-10, xmax = bbox[[3]]+10, ymax = bbox[[4]]+10))
box_l = st_bbox(c(xmin = bbox[[1]]-10, ymin = bbox[[2]]-10, xmax = bbox[[3]]+10, ymax = bbox[[4]]+10))
bbox_l = st_bbox(c(xmin = bbox[[1]]-10, ymin = bbox[[2]]-10, xmax = bbox[[3]]+10, ymax = bbox[[4]]+10))
st_sfc(bbox_l)
st_as_sfc(bbox_l)
bbox2 = st_bbox(c(xmin = bbox[[1]]-10, ymin = bbox[[2]]-10, xmax = bbox[[3]]+10, ymax = bbox[[4]]+10))
bbox2 = st_bbox(c(xmin = bbox[[1]]-10, ymin = bbox[[2]]-10, xmax = bbox[[3]]+10, ymax = bbox[[4]]+10))
bbox_line2 = st_as_sfc(bbox2)
plot(bbox_line)
plot(bbox_line2, add = TRUE)
bbox2
bbox_line2
bbox_poly2 = st_as_sfc(bbox2)
bbox_poly2 = st_transform(bbox_poly2, 27700)
plot(bbox_poly)
plot(bbox_poly2, add = TRUE)
bbox
bbox2
plot(bbox_poly2, add = TRUE, col = "blue")
plot(bbox_poly2, add = TRUE, border = "blue")
plot(bbox_poly)
plot(bbox_poly2, add = TRUE, border = "blue")
bbox
st_crs(bbox)
bbox2 = st_bbox(c(xmin = bbox[[1]]-10, ymin = bbox[[2]]-10, xmax = bbox[[3]]+10, ymax = bbox[[4]]+10), crs = 27700)
bbox_poly2 = st_as_sfc(bbox2)
bbox_line2
bbox_poly2 = st_as_sfc(bbox2, crs = 27700)
bbox_line2
bbox_poly2
bbox_poly2 = st_as_sfc(bbox2)
bbox_poly2 = st_as_sfc(bbox2)
bbox_poly2
plot(bbox_poly)
plot(bbox_poly2, add = TRUE, border = "blue")
View(bbox_poly2)
bbox
bbox2
polys = c(bbox_poly,bbox_poly2)
View(polys)
bbox_poly
bbox_poly2
st_buffer(bbox_poly, dist = 10)
b = st_buffer(bbox_poly, dist = 10)
plot(b)
plot(bbox_poly, add = TRUE)
b = st_buffer(bbox_poly, dist = set_units(10, "m"))
plot(b)
plot(bbox_poly, add = TRUE)
b = st_buffer(bbox_poly, dist = set_units(30, "m"))
plot(b)
plot(bbox_poly, add = TRUE)
b = st_buffer(bbox_poly, dist = set_units(50, "m"))
plot(b)
plot(bbox_poly, add = TRUE)
b = st_buffer(bbox_poly, dist = set_units(100, "m"))
b = st_buffer(bbox_poly, dist = set_units(50, "m"))
plot(b)
plot(bbox_poly, add = TRUE)
bbox_poly = st_as_sfc(bbox, 27700)
bbox_poly
bbox_poly = st_as_sfc(bbox, 27700)
box_poly_plus50 = st_buffer(bbox_poly, dist = set_units(50, "m"))
box_poly_plus50 = st_buffer(bbox_poly, dist = set_units(50, "m"))
gg = st_intersection(g2, bbox_poly_plus50)
bbox_poly_plus50 = st_buffer(bbox_poly, dist = set_units(50, "m"))
gg = st_intersection(g2, bbox_poly_plus50)
plot(gg$g2)
plot(bbox_line, add = TRUE)
m = midlines_draw(gg)
plot(m$geom, col = m$line_id, add = TRUE)
m2 = midlines_clean(m, n_removed = 10, border_line = bbox_line)
plot(gg$g2)
plot(m2$geometry, col = m2$removed_flag, add = TRUE)
